<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SignUp</title>
    <link rel="stylesheet" href="/style.css">
    <style>
        .error-message {
            color: red;
            font-size: 0.9em;
            display: none;
        }
    </style>
    <script>
        function synchronizeUsername() {
            const emailField = document.getElementById('email');
            const usernameField = document.getElementById('username');
            usernameField.value = emailField.value;
        }

        function validateEmail() {
            const emailField = document.getElementById('email');
            const emailError = document.getElementById('email-error');
            const submitBtn = document.querySelector('.submit-btn');
            const email = emailField.value;
            const domain = email.substring(email.lastIndexOf("@") + 1);
            
            if (domain !== "student.vgu.edu.vn") {
                emailError.textContent = "Invalid email. Please use a @student.vgu.edu.vn email address.";
                emailError.style.display = "block";
                submitBtn.disabled = true;
            } else {
                emailError.style.display = "none";
                submitBtn.disabled = false;
            }

            synchronizeUsername(); // Update username with email value
        }

        function validatePassword() {
            const passwordField = document.getElementById('password');
            const passwordError = document.getElementById('password-error');
            const confirmPasswordField = document.getElementById('confirm-password');
            const submitBtn = document.querySelector('.submit-btn');
            const password = passwordField.value;
            const confirmPassword = confirmPasswordField.value;
            const specialCharPattern = /[!@#$%^&*(),.?":{}|<>]/g;

            if (password.length < 8 || !specialCharPattern.test(password)) {
                passwordError.textContent = "Password must be at least 8 characters and contain at least one special character.";
                passwordError.style.display = "block";
                submitBtn.disabled = true;
            } else {
                passwordError.style.display = "none";
                if (password === confirmPassword) {
                    submitBtn.disabled = false;
                }
            }
        }

        function validateConfirmPassword() {
            const passwordField = document.getElementById('password');
            const confirmPasswordField = document.getElementById('confirm-password');
            const confirmPasswordError = document.getElementById('confirm-password-error');
            const submitBtn = document.querySelector('.submit-btn');
            const password = passwordField.value;
            const confirmPassword = confirmPasswordField.value;

            if (password !== confirmPassword) {
                confirmPasswordError.textContent = "Passwords do not match.";
                confirmPasswordError.style.display = "block";
                submitBtn.disabled = true;
            } else {
                confirmPasswordError.style.display = "none";
                submitBtn.disabled = false;
            }
        }
    </script>
</head>
<body>
    <div class="form-container">
        <h2>SignUp</h2>
        <form action="/user/signup" method="post">
            <div class="form-group">
                <label for="name">Name</label>
                <input type="text" id="name" name="name" placeholder="Enter your name" required autocomplete="off">
            </div>
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" name="email" placeholder="Enter your @student.vgu.edu.vn email" required autocomplete="off" onblur="validateEmail()">
                <div id="email-error" class="error-message"></div>
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" name="password" id="password" placeholder="Enter your password" required onblur="validatePassword()">
                <div id="password-error" class="error-message"></div>
            </div>
            <button type="submit" class="submit-btn">Sign Up</button>
        </form>
    </div>
</body>
</html>
